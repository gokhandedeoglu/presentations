{"version":3,"sources":["proto_view_builder.js"],"names":[],"mappings":"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","file":"/home/korchev/github/angular/modules/angular2/src/render/dom/view/proto_view_builder.js","sourcesContent":["import {isPresent, isBlank, BaseException} from 'angular2/src/facade/lang';\nimport {ListWrapper, MapWrapper, Set, SetWrapper} from 'angular2/src/facade/collection';\nimport {DOM} from 'angular2/src/dom/dom_adapter';\n\nimport {\n  ASTWithSource, AST, AstTransformer, AccessMember, LiteralArray, ImplicitReceiver\n} from 'angular2/change_detection';\nimport {SetterFn} from 'angular2/src/reflection/types';\n\nimport {ProtoView} from './proto_view';\nimport {ElementBinder} from './element_binder';\nimport {setterFactory} from './property_setter_factory';\n\nimport * as api from '../../api';\nimport * as directDomRenderer from '../direct_dom_renderer';\n\nimport {NG_BINDING_CLASS} from '../util';\n\nexport class ProtoViewBuilder {\n  rootElement;\n  variableBindings: Map<string, string>;\n  elements:List<ElementBinderBuilder>;\n  isRootView:boolean;\n\n  constructor(rootElement) {\n    this.rootElement = rootElement;\n    this.elements = [];\n    this.isRootView = false;\n    this.variableBindings = MapWrapper.create();\n  }\n\n  bindElement(element, description = null):ElementBinderBuilder {\n    var builder = new ElementBinderBuilder(this.elements.length, element, description);\n    ListWrapper.push(this.elements, builder);\n    DOM.addClass(element, NG_BINDING_CLASS);\n\n    return builder;\n  }\n\n  bindVariable(name, value) {\n    // Store the variable map from value to variable, reflecting how it will be used later by\n    // View. When a local is set to the view, a lookup for the variable name will take place keyed\n    // by the \"value\", or exported identifier. For example, ng-repeat sets a view local of \"index\".\n    // When this occurs, a lookup keyed by \"index\" must occur to find if there is a var referencing\n    // it.\n    MapWrapper.set(this.variableBindings, value, name);\n  }\n\n  setIsRootView(value) {\n    this.isRootView = value;\n  }\n\n  build():api.ProtoView {\n    var renderElementBinders = [];\n\n    var apiElementBinders = [];\n    ListWrapper.forEach(this.elements, (ebb) => {\n      var propertySetters = MapWrapper.create();\n      var eventLocalsAstSplitter = new EventLocalsAstSplitter();\n      var apiDirectiveBinders = ListWrapper.map(ebb.directives, (db) => {\n        return new api.DirectiveBinder({\n          directiveIndex: db.directiveIndex,\n          propertyBindings: db.propertyBindings,\n          eventBindings: eventLocalsAstSplitter.splitEventAstIntoLocals(db.eventBindings)\n        });\n      });\n      MapWrapper.forEach(ebb.propertySetters, (setter, propertyName) => {\n        MapWrapper.set(propertySetters, propertyName, setter);\n      });\n      var nestedProtoView =\n          isPresent(ebb.nestedProtoView) ? ebb.nestedProtoView.build() : null;\n      var parentIndex = isPresent(ebb.parent) ? ebb.parent.index : -1;\n      ListWrapper.push(apiElementBinders, new api.ElementBinder({\n        index: ebb.index, parentIndex:parentIndex, distanceToParent:ebb.distanceToParent,\n        directives: apiDirectiveBinders,\n        nestedProtoView: nestedProtoView,\n        propertyBindings: ebb.propertyBindings, variableBindings: ebb.variableBindings,\n        eventBindings: eventLocalsAstSplitter.splitEventAstIntoLocals(ebb.eventBindings),\n        textBindings: ebb.textBindings,\n        readAttributes: ebb.readAttributes\n      }));\n      ListWrapper.push(renderElementBinders, new ElementBinder({\n        textNodeIndices: ebb.textBindingIndices,\n        contentTagSelector: ebb.contentTagSelector,\n        parentIndex: parentIndex,\n        distanceToParent: ebb.distanceToParent,\n        nestedProtoView: isPresent(nestedProtoView) ? nestedProtoView.render.delegate : null,\n        componentId: ebb.componentId,\n        eventLocals: eventLocalsAstSplitter.buildEventLocals(),\n        eventNames: eventLocalsAstSplitter.buildEventNames(),\n        propertySetters: propertySetters\n      }));\n    });\n    return new api.ProtoView({\n      render: new directDomRenderer.DirectDomProtoViewRef(new ProtoView({\n        element: this.rootElement,\n        elementBinders: renderElementBinders,\n        isRootView: this.isRootView\n      })),\n      elementBinders: apiElementBinders,\n      variableBindings: this.variableBindings\n    });\n  }\n}\n\nexport class ElementBinderBuilder {\n  element;\n  index:number;\n  parent:ElementBinderBuilder;\n  distanceToParent:number;\n  directives:List<DirectiveBuilder>;\n  nestedProtoView:ProtoViewBuilder;\n  propertyBindings: Map<string, ASTWithSource>;\n  variableBindings: Map<string, string>;\n  eventBindings: Map<string, ASTWithSource>;\n  textBindingIndices: List<number>;\n  textBindings: List<ASTWithSource>;\n  contentTagSelector:string;\n  propertySetters: Map<string, SetterFn>;\n  readAttributes: Map<string, string>;\n  componentId: string;\n\n  constructor(index, element, description) {\n    this.element = element;\n    this.index = index;\n    this.parent = null;\n    this.distanceToParent = 0;\n    this.directives = [];\n    this.nestedProtoView = null;\n    this.propertyBindings = MapWrapper.create();\n    this.variableBindings = MapWrapper.create();\n    this.eventBindings = MapWrapper.create();\n    this.textBindings = [];\n    this.textBindingIndices = [];\n    this.contentTagSelector = null;\n    this.propertySetters = MapWrapper.create();\n    this.componentId = null;\n    this.readAttributes = MapWrapper.create();\n  }\n\n  setParent(parent:ElementBinderBuilder, distanceToParent):ElementBinderBuilder {\n    this.parent = parent;\n    if (isPresent(parent)) {\n      this.distanceToParent = distanceToParent;\n    }\n    return this;\n  }\n\n  readAttribute(attrName:string) {\n    if (isBlank(MapWrapper.get(this.readAttributes, attrName))) {\n      MapWrapper.set(this.readAttributes, attrName, DOM.getAttribute(this.element, attrName));\n    }\n  }\n\n  bindDirective(directiveIndex:number):DirectiveBuilder {\n    var directive = new DirectiveBuilder(directiveIndex);\n    ListWrapper.push(this.directives, directive);\n    return directive;\n  }\n\n  bindNestedProtoView(rootElement):ProtoViewBuilder {\n    if (isPresent(this.nestedProtoView)) {\n      throw new BaseException('Only one nested view per element is allowed');\n    }\n    this.nestedProtoView = new ProtoViewBuilder(rootElement);\n    return this.nestedProtoView;\n  }\n\n  bindProperty(name, expression) {\n    MapWrapper.set(this.propertyBindings, name, expression);\n    this.bindPropertySetter(name);\n  }\n\n  bindPropertySetter(name) {\n    MapWrapper.set(this.propertySetters, name, setterFactory(name));\n  }\n\n  bindVariable(name, value) {\n    // When current is a view root, the variable bindings are set to the *nested* proto view.\n    // The root view conceptually signifies a new \"block scope\" (the nested view), to which\n    // the variables are bound.\n    if (isPresent(this.nestedProtoView)) {\n      this.nestedProtoView.bindVariable(name, value);\n    } else {\n      // Store the variable map from value to variable, reflecting how it will be used later by\n      // View. When a local is set to the view, a lookup for the variable name will take place keyed\n      // by the \"value\", or exported identifier. For example, ng-repeat sets a view local of \"index\".\n      // When this occurs, a lookup keyed by \"index\" must occur to find if there is a var referencing\n      // it.\n      MapWrapper.set(this.variableBindings, value, name);\n    }\n  }\n\n  bindEvent(name, expression) {\n    MapWrapper.set(this.eventBindings, name, expression);\n  }\n\n  bindText(index, expression) {\n    ListWrapper.push(this.textBindingIndices, index);\n    ListWrapper.push(this.textBindings, expression);\n  }\n\n  setContentTagSelector(value:string) {\n    this.contentTagSelector = value;\n  }\n\n  setComponentId(componentId:string) {\n    this.componentId = componentId;\n  }\n}\n\nexport class DirectiveBuilder {\n  directiveIndex:number;\n  propertyBindings: Map<string, ASTWithSource>;\n  eventBindings: Map<string, ASTWithSource>;\n\n  constructor(directiveIndex) {\n    this.directiveIndex = directiveIndex;\n    this.propertyBindings = MapWrapper.create();\n    this.eventBindings = MapWrapper.create();\n  }\n\n  bindProperty(name, expression) {\n    MapWrapper.set(this.propertyBindings, name, expression);\n  }\n\n  bindEvent(name, expression) {\n    MapWrapper.set(this.eventBindings, name, expression);\n  }\n}\n\nexport class EventLocalsAstSplitter extends AstTransformer {\n  locals:List<AST>;\n  eventNames:List<string>;\n  _implicitReceiver:AST;\n\n  constructor() {\n    super();\n    this.locals = [];\n    this.eventNames = [];\n    this._implicitReceiver = new ImplicitReceiver();\n  }\n\n  splitEventAstIntoLocals(eventBindings:Map<string, ASTWithSource>):Map<string, ASTWithSource> {\n    // TODO(tbosch): reenable this when we are using\n    // the render views\n    return eventBindings;\n    // if (isPresent(eventBindings)) {\n    //   var result = MapWrapper.create();\n    //   MapWrapper.forEach(eventBindings, (astWithSource, eventName) => {\n    //     var adjustedAst = astWithSource.ast.visit(this);\n    //     MapWrapper.set(result, eventName, new ASTWithSource(adjustedAst, astWithSource.source, ''));\n    //     ListWrapper.push(this.eventNames, eventName);\n    //   });\n    //   return result;\n    // }\n    // return null;\n  }\n\n  visitAccessMember(ast:AccessMember) {\n    var isEventAccess = false;\n    var current = ast;\n    while (!isEventAccess && (current instanceof AccessMember)) {\n      if (current.name == '$event') {\n        isEventAccess = true;\n      }\n      current = current.receiver;\n    }\n\n    if (isEventAccess) {\n      ListWrapper.push(this.locals, ast);\n      var index = this.locals.length - 1;\n      return new AccessMember(this._implicitReceiver, `${index}`, (arr) => arr[index], null);\n    } else {\n      return ast;\n    }\n  }\n\n  buildEventLocals() {\n    return new LiteralArray(this.locals);\n  }\n\n  buildEventNames() {\n    return this.eventNames;\n  }\n}"]}